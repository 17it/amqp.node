<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="amqplib : AMQP 0-9-1 library and client for Node.JS" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>amqplib</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/squaremo/amqp.node">View on GitHub</a>

          <h1 id="project_title">amqplib</h1>
          <h2 id="project_tagline">AMQP 0-9-1 library and client for Node.JS</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/squaremo/amqp.node/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/squaremo/amqp.node/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a name="amqp-0-9-1-library-and-client-for-nodejs" class="anchor" href="#amqp-0-9-1-library-and-client-for-nodejs"><span class="octicon octicon-link"></span></a>AMQP 0-9-1 library and client for Node.JS</h1>

<p><code>amqplib</code> implements the machinery needed to make clients for AMQP
0-9-1, and includes such a client. Why phrase it that way around?
Because AMQP is complicated enough that there are a few different ways
of presenting it in API form (e.g., <a href="https://github.com/postwait/node-amqp">node-amqp</a> deals with
exchanges and queues as first-class objects, while hiding channels;
<a href="https://github.com/squaremo/rabbit.js">rabbit.js</a> deprecates exchanges and queues in favour of
routing patterns).</p>

<p>AMQP often seems to be designed to confound client developers; it is
not very cleanly layered and there are consequences to molding it this
way or that in search of a usable API. In <code>amqplib</code> I have tried to
implement only the necessary machinery of AMQP, in layers as best I
can, without prejudice to any particular client API.</p>

<h2>
<a name="channel-api-overview" class="anchor" href="#channel-api-overview"><span class="octicon octicon-link"></span></a>Channel API overview</h2>

<div class="highlight"><pre><span class="kd">var</span> <span class="nx">q</span> <span class="o">=</span> <span class="s1">'tasks'</span><span class="p">;</span>

<span class="c1">// Publisher</span>
<span class="kd">var</span> <span class="nx">open</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'amqplib'</span><span class="p">).</span><span class="nx">connect</span><span class="p">(</span><span class="s1">'amqp://localhost'</span><span class="p">);</span>
<span class="nx">open</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">conn</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">ok</span> <span class="o">=</span> <span class="nx">conn</span><span class="p">.</span><span class="nx">createChannel</span><span class="p">();</span>
  <span class="nx">ok</span> <span class="o">=</span> <span class="nx">ok</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">ch</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">ch</span><span class="p">.</span><span class="nx">assertQueue</span><span class="p">(</span><span class="nx">q</span><span class="p">);</span>
    <span class="nx">ch</span><span class="p">.</span><span class="nx">sendToQueue</span><span class="p">(</span><span class="nx">q</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Buffer</span><span class="p">(</span><span class="s1">'something to do'</span><span class="p">));</span>
  <span class="p">});</span>
  <span class="k">return</span> <span class="nx">ok</span><span class="p">;</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">);</span>

<span class="c1">// Consumer</span>
<span class="nx">open</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">conn</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">ok</span> <span class="o">=</span> <span class="nx">conn</span><span class="p">.</span><span class="nx">createChannel</span><span class="p">();</span>
  <span class="nx">ok</span> <span class="o">=</span> <span class="nx">ok</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">ch</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">ch</span><span class="p">.</span><span class="nx">assertQueue</span><span class="p">(</span><span class="nx">q</span><span class="p">);</span>
    <span class="nx">ch</span><span class="p">.</span><span class="nx">consume</span><span class="p">(</span><span class="nx">q</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">content</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
      <span class="nx">ch</span><span class="p">.</span><span class="nx">ack</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">});</span>
  <span class="k">return</span> <span class="nx">ok</span><span class="p">;</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">);</span>
</pre></div>

<p>The client API included is channel-oriented. This represents the
protocol fairly directly, as connections and channels (something like
'sessions'). Most of the operations in the API are accessed by
creating a channel and calling methods; exchanges and queues are only
represented insofar as they are named (with strings) in these
operations.</p>

<p>Almost all operations are asynchronous RPCs; these methods on
<code>Channel</code> return promises which can be composed in all the usual
ways. Some operations (e.g., <code>#ack</code>) elicit no response from the
server, and don't return a promise.</p>

<p>In general I have made arguments that are mandatory in the protocol
into method arguments in the API, and coalesced optional arguments,
properties, and RabbitMQ extensions into a single <code>options</code> argument
which can be ommitted altogether.</p>

<p>The <a href="doc/channel_api.html">reference</a> has full details.</p>

<h2>
<a name="library-overview" class="anchor" href="#library-overview"><span class="octicon octicon-link"></span></a>Library overview</h2>

<p>To be able to get anywhere at all, an AMQP library needs to be able to</p>

<ul>
<li>parse and serialise frames</li>
<li>maintain connection and channel state</li>
<li>implement the opening and closing handshakes</li>
</ul><p>In <code>amqplib</code>, parsing and serialising are dealt with in the modules</p>

<ul>
<li>
<code>codec</code> procedures for parsing and serialising values;</li>
<li> <code>defs</code> generated code for encoding and decoding protocol methods;
and,</li>
<li>
<code>frames</code> for turning a byte streams into decoded frames and
vice-versa.</li>
</ul><p>Connection state is maintained in a <code>Connection</code> object (module
<code>connection</code>) and channel state in a <code>Channel</code> (module <code>channel</code>);
these two modules also implement the opening and closing handshakes.</p>

<p>The interfaces among these modules is small and mostly mediated with
primitive values; e.g., strings and numbers. A few points of interface
require callbacks in the form of duck-typed objects (e.g., an object
with an <code>#accept</code> method).</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">amqplib maintained by <a href="https://github.com/squaremo">squaremo</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
